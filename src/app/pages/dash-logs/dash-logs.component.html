<div class="dashlogs-container">
  <h2>Dashboard de Logs</h2>

  <div *ngIf="summary">
    <div class="summary-cards">
      <div class="card highlight">Total logs: <b>{{ summary.total_logs }}</b></div>
      <div class="card">Promedio Response Time: <b>{{ summary.avg_response_time }} s</b></div>
      <div class="card">API más rápida: <b>{{ summary.api_mas_rapida }}</b></div>
      <div class="card">API más lenta: <b>{{ summary.api_mas_lenta }}</b></div>
      <div class="card">API más consumida: <b>{{ summary.api_mas_consumida }}</b></div>
      <div class="card">API menos consumida: <b>{{ summary.api_menos_consumida }}</b></div>
    </div>

    <div class="charts-row">
      <div class="chart-box chart-box-wide">
        <h4>Status de Respuestas</h4>
        <div class="status-legend" style="margin-bottom: 1rem;">
          <b>Significado de códigos de estado:</b>
          <ul style="margin: 0.5rem 0 0 0; padding: 0; list-style: none;">
            <li><b>200</b>: Exitoso</li>
            <li><b>201</b>: Creado</li>
            <li><b>401</b>: No autorizado</li>
            <li><b>404</b>: No encontrado</li>
            <li *ngFor="let code of statusChartData.labels" [hidden]="['200','201','401','404'].includes(code + '')">
              <b>{{ code }}</b>: {{ getStatusDescription(code) }}
            </li>
          </ul>
        </div>
        <div style="width: 100%; min-width: 700px; max-width: 1200px; height: 420px; margin: 0 auto;">
          <canvas baseChart
            [data]="statusChartData"
            [type]="statusChartType"
            [options]="{responsive: true, maintainAspectRatio: false}"
            style="height: 400px; width: 100%; display: block;">
          </canvas>
        </div>
      </div>
    </div>


    <div class="api-table-container">
      <h4>Logs históricos del sistema</h4>
      <div class="log-filters">
        <div class="filter-group">
          <label for="apiFilter">API</label>
          <select id="apiFilter" [(ngModel)]="filterApi">
            <option value="">Todas</option>
            <option *ngFor="let api of apiOptions" [value]="api">{{ api }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="statusFilter">Status</label>
          <select id="statusFilter" [(ngModel)]="filterStatus">
            <option value="">Todos</option>
            <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="descFilter">Descripción</label>
          <input id="descFilter" type="text" [(ngModel)]="filterDescription" placeholder="Buscar..." />
        </div>
        <div class="filter-group">
          <label for="dateFrom">Desde</label>
          <input id="dateFrom" type="date" [(ngModel)]="filterDateFrom" />
        </div>
        <div class="filter-group">
          <label for="dateTo">Hasta</label>
          <input id="dateTo" type="date" [(ngModel)]="filterDateTo" />
        </div>
      </div>
      <table class="api-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>API</th>
            <th>Status</th>
            <th>Descripción</th>
            <th>Duración (s)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of filteredLogs">
            <td>{{ log.timestamp || log.date || log.time }}</td>
            <td>{{ log.api_name }}</td>
            <td>{{ log.status_code }}</td>
            <td>{{ statusDescriptions[log.status_code?.toString()] || 'Otro' }}</td>
            <td>{{ log.duration | number:'1.3-3' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div *ngIf="!summary">
    <p>Cargando datos...</p>
  </div>
</div>
